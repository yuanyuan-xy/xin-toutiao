(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-33ecfa60"],{"159b":function(e,t,a){var n=a("da84"),r=a("fdbc"),i=a("17c2"),c=a("9112");for(var o in r){var s=n[o],l=s&&s.prototype;if(l&&l.forEach!==i)try{c(l,"forEach",i)}catch(u){l.forEach=i}}},"17c2":function(e,t,a){"use strict";var n=a("b727").forEach,r=a("a640"),i=a("ae40"),c=r("forEach"),o=i("forEach");e.exports=c&&o?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},"1e63":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"publish"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:"/"}},[e._v("首页")]),a("el-breadcrumb-item",[e._v(e._s(e.$route.query.id?"修改文章":"发布文章"))])],1)],1),a("el-form",{ref:"publish-form",attrs:{model:e.article,"label-width":"60px",rules:e.publishRules}},[a("el-form-item",{attrs:{label:"标题",prop:"title"}},[a("el-input",{model:{value:e.article.title,callback:function(t){e.$set(e.article,"title",t)},expression:"article.title"}})],1),a("el-form-item",{attrs:{label:"内容",prop:"content"}},[a("el-tiptap",{attrs:{extensions:e.extensions,height:"350"},model:{value:e.article.content,callback:function(t){e.$set(e.article,"content",t)},expression:"article.content"}})],1),a("el-form-item",{attrs:{label:"封面"}},[a("el-radio-group",{model:{value:e.article.cover.type,callback:function(t){e.$set(e.article.cover,"type",t)},expression:"article.cover.type"}},[a("el-radio",{attrs:{label:1}},[e._v("单图")]),a("el-radio",{attrs:{label:3}},[e._v("三图")]),a("el-radio",{attrs:{label:0}},[e._v("无图")]),a("el-radio",{attrs:{label:-1}},[e._v("自动")])],1),e.article.cover.type>0?e._l(e.article.cover.type,(function(t,n){return a("upload-cover",{key:t,staticClass:"cover-container",model:{value:e.article.cover.images[n],callback:function(t){e.$set(e.article.cover.images,n,t)},expression:"article.cover.images[index]"}})})):e._e()],2),a("el-form-item",{attrs:{label:"频道",prop:"channel_id"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.article.channel_id,callback:function(t){e.$set(e.article,"channel_id",t)},expression:"article.channel_id"}},e._l(e.channels,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onPublish(!1)}}},[e._v(e._s(e.$route.query.id?"修改":"发布"))]),a("el-button",{on:{click:function(t){return e.onPublish(!0)}}},[e._v("存为草稿")])],1)],1)],1)],1)},r=[],i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"uploadCover",on:{click:e.showCoverSelect}},[a("div",{staticClass:"cover-wrap"},[a("img",{ref:"previewImage",staticClass:"cover-image",attrs:{src:e.value,alt:""}})]),a("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible,"append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-tabs",{attrs:{type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"收藏封面",name:"first"}},[a("image-list",{ref:"image-list",attrs:{"is-show-add":!1,"is-show-active":!1}})],1),a("el-tab-pane",{attrs:{label:"上传",name:"second"}},[a("input",{ref:"file",attrs:{type:"file"},on:{change:e.onFileChange}}),a("img",{ref:"preview-image",attrs:{width:"100"}})])],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.onCoverConfirm}},[e._v("确 定")])],1)],1)],1)},c=[],o=(a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("96cf"),a("1da1")),s=a("c120"),l=a("685c"),u={props:["value"],components:{ImageList:s["a"]},name:"uploadCover",data:function(){return{dialogVisible:!1,activeName:"first",previewImage:""}},methods:{showCoverSelect:function(){this.dialogVisible=!0},onFileChange:function(){var e=this.$refs.file,t=window.URL.createObjectURL(e.files[0]);this.$refs["preview-image"].src=t},onCoverConfirm:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,n,r,i,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("second"!==e.activeName){t.next=14;break}if(a=e.$refs.file.files[0],a){t.next=5;break}return e.$message("请选择图片"),t.abrupt("return");case 5:return n=new FormData,n.append("image",a),t.next=9,Object(l["d"])(n);case 9:r=t.sent,e.dialogVisible=!1,e.$emit("input",r.data.data.url),t.next=22;break;case 14:if("first"!==e.activeName){t.next=22;break}if(i=e.$refs["image-list"],c=i.selected,null!==c){t.next=20;break}return e.$message("请选择图片"),t.abrupt("return");case 20:e.dialogVisible=!1,e.$emit("input",i.images[c].url);case 22:case"end":return t.stop()}}),t)})))()}}},d=u,f=(a("4410"),a("2877")),p=Object(f["a"])(d,i,c,!1,null,"ffa84df6",null),m=p.exports,g=a("2423"),v=a("4ccc"),h=(a("7eef"),{name:"PublishIndex",components:{"el-tiptap":v["d"],UploadCover:m},data:function(){return{channels:[],article:{title:"",content:"",cover:{type:1,images:[]},channel_id:""},extensions:[new v["c"],new v["m"],new v["k"],new v["f"]({level:5}),new v["a"]({bubble:!0}),new v["n"],new v["h"],new v["l"],new v["i"],new v["b"],new v["j"],new v["g"]({uploadRequest:function(e){var t=new FormData;return t.append("image",e),Object(l["d"])(t).then((function(e){return e.data.data.url}))}})],publishRules:{title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:5,max:30,message:"长度在 5 到 30 个字符",trigger:"blur"}],content:[{validator:function(e,t,a){"<p></p>"===t?a(new Error("内容不能为空")):a()}},{required:!0,message:"请输入内容",trigger:"blur"}],channel_id:[{required:!0,message:"请选择频道"}]}}},created:function(){this.getChannels(),this.$route.query.id&&this.getArticleInfo()},methods:{onPublish:function(e){var t=this;this.$refs["publish-form"].validate((function(a){a&&(t.$route.query.id?Object(g["c"])(t.$route.query.id,t.article,e).then((function(a){t.$message({message:"".concat(e?"存为草稿":"修改","成功"),type:"success"}),t.$router.push("/article")})):Object(g["a"])(t.article,e).then((function(a){t.$message({message:e?"存为草稿成功":"发布内容成功",type:"success"}),t.$router.push("/article")})))}))},getChannels:function(){var e=this;Object(g["f"])().then((function(t){e.channels=t.data.data.channels}))},getArticleInfo:function(){var e=this;Object(g["e"])(this.$route.query.id).then((function(t){e.article=t.data.data}))}}}),b=h,w=Object(f["a"])(b,n,r,!1,null,"af444768",null);t["default"]=w.exports},"1fba":function(e,t,a){},2423:function(e,t,a){"use strict";a.d(t,"g",(function(){return r})),a.d(t,"f",(function(){return i})),a.d(t,"b",(function(){return c})),a.d(t,"a",(function(){return o})),a.d(t,"e",(function(){return s})),a.d(t,"c",(function(){return l})),a.d(t,"d",(function(){return u}));var n=a("b775"),r=function(e){return Object(n["a"])({method:"GET",url:"/mp/v1_0/articles",params:e})},i=function(){return Object(n["a"])({method:"GET",url:"/mp/v1_0/channels"})},c=function(e){return Object(n["a"])({method:"DELETE",url:"/mp/v1_0/articles/".concat(e)})},o=function(e,t){return Object(n["a"])({method:"POST",url:"/mp/v1_0/articles",params:{draft:t},data:e})},s=function(e){return Object(n["a"])({method:"GET",url:"/mp/v1_0/articles/".concat(e)})},l=function(e,t,a){return Object(n["a"])({method:"PUT",url:"/mp/v1_0/articles/".concat(e),params:{draft:a},data:t})},u=function(e,t){return Object(n["a"])({method:"PUT",url:"/mp/v1_0/comments/status",params:{article_id:e},data:{allow_comment:t}})}},"324a":function(e,t,a){},4160:function(e,t,a){"use strict";var n=a("23e7"),r=a("17c2");n({target:"Array",proto:!0,forced:[].forEach!=r},{forEach:r})},4410:function(e,t,a){"use strict";var n=a("1fba"),r=a.n(n);r.a},"65f0":function(e,t,a){var n=a("861d"),r=a("e8b5"),i=a("b622"),c=i("species");e.exports=function(e,t){var a;return r(e)&&(a=e.constructor,"function"!=typeof a||a!==Array&&!r(a.prototype)?n(a)&&(a=a[c],null===a&&(a=void 0)):a=void 0),new(void 0===a?Array:a)(0===t?0:t)}},"685c":function(e,t,a){"use strict";a.d(t,"d",(function(){return r})),a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return c})),a.d(t,"c",(function(){return o}));var n=a("b775"),r=function(e){return Object(n["a"])({method:"POST",url:"/mp/v1_0/user/images",data:e})},i=function(e){return Object(n["a"])({method:"GET",url:"/mp/v1_0/user/images",params:e})},c=function(e){return Object(n["a"])({method:"DELETE",url:"/mp/v1_0/user/images/".concat(e)})},o=function(e,t){return Object(n["a"])({method:"PUT",url:"/mp/v1_0/user/images/".concat(e),data:{collect:t}})}},"8ce3":function(e,t,a){"use strict";var n=a("324a"),r=a.n(n);r.a},a640:function(e,t,a){"use strict";var n=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&n((function(){a.call(null,t||function(){throw 1},1)}))}},ae40:function(e,t,a){var n=a("83ab"),r=a("d039"),i=a("5135"),c=Object.defineProperty,o={},s=function(e){throw e};e.exports=function(e,t){if(i(o,e))return o[e];t||(t={});var a=[][e],l=!!i(t,"ACCESSORS")&&t.ACCESSORS,u=i(t,0)?t[0]:s,d=i(t,1)?t[1]:void 0;return o[e]=!!a&&!r((function(){if(l&&!n)return!0;var e={length:-1};l?c(e,1,{enumerable:!0,get:s}):e[1]=1,a.call(e,u,d)}))}},b727:function(e,t,a){var n=a("0366"),r=a("44ad"),i=a("7b0b"),c=a("50c4"),o=a("65f0"),s=[].push,l=function(e){var t=1==e,a=2==e,l=3==e,u=4==e,d=6==e,f=5==e||d;return function(p,m,g,v){for(var h,b,w=i(p),_=r(w),y=n(m,g,3),x=c(_.length),C=0,k=v||o,O=t?k(p,x):a?k(p,0):void 0;x>C;C++)if((f||C in _)&&(h=_[C],b=y(h,C,w),e))if(t)O[C]=b;else if(b)switch(e){case 3:return!0;case 5:return h;case 6:return C;case 2:s.call(O,h)}else if(u)return!1;return d?-1:l||u?u:O}};e.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6)}},c120:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"action-btn"},[a("el-radio-group",{attrs:{size:"mini"},on:{change:e.onCollectChange},model:{value:e.collect,callback:function(t){e.collect=t},expression:"collect"}},[a("el-radio-button",{attrs:{label:!1}},[e._v("全部")]),a("el-radio-button",{attrs:{label:!0}},[e._v("收藏")])],1),e.isShowAdd?a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("上传素材")]):e._e()],1),a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],attrs:{gutter:10}},e._l(e.images,(function(t,n){return a("el-col",{key:t.id,attrs:{xs:12,sm:6,md:6,lg:4,xl:4},nativeOn:{click:function(t){e.selected=n}}},[a("div",{staticClass:"star-col"},[a("el-image",{staticClass:"star-image",attrs:{src:t.url,fit:"cover"}}),e.isShowSelected&&e.selected===n?a("div",{staticClass:"selected"}):e._e(),e.isShowActive?a("div",{staticClass:"star-handle"},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.is_collected?"取消收藏":"添加收藏",placement:"top-start"}},[a("el-button",{attrs:{type:t.is_collected?"success":"warning",icon:t.is_collected?"el-icon-check":"el-icon-star-off",size:"mini",circle:"",loading:t.loading},on:{click:function(a){return e.onStarImage(t)}}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除此素材",placement:"top-start"}},[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"mini",loading:t.loading},on:{click:function(a){return e.del(t)}}})],1)],1):e._e()],1)])})),1),a("el-dialog",{attrs:{title:"上传素材",visible:e.dialogVisible,width:"30%","before-close":e.handleClose,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:"http://ttapi.research.itcast.cn/mp/v1_0/user/images",name:"image",headers:e.uploadheaders,"show-file-list":!0,"on-success":e.onUploadSuccess,multiple:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),a("em",[e._v("点击上传")])]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过500kb")])])],1),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.total,"page-size":e.pageSize,"current-page":e.page},on:{"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"current-change":e.currentChange}})],1)},r=[],i=(a("4160"),a("159b"),a("96cf"),a("1da1")),c=a("685c"),o={props:{isShowAdd:{type:Boolean,default:!0},isShowActive:{type:Boolean,default:!0},isShowSelected:{type:Boolean,default:!0}},name:"ImageList",data:function(){var e=JSON.parse(window.localStorage.getItem("user"));return{collect:!1,images:[],dialogVisible:!1,uploadheaders:{Authorization:"Bearer ".concat(e.token)},total:0,page:1,pageSize:12,isLoading:!0,selected:null}},created:function(){this.loadImages(!1)},methods:{loadImages:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]&&e[0],t.isLoading=!0,a.next=4,Object(c["b"])({collect:n,page:t.page,per_page:t.pageSize});case 4:r=a.sent,i=r.data.data.results,i.forEach((function(e){e.loading=!1})),t.isLoading=!1,t.total=r.data.data.total_count,t.images=i;case 10:case"end":return a.stop()}}),a)})))()},onCollectChange:function(e){this.page=1,this.loadImages(e)},handleClose:function(e){e()},onUploadSuccess:function(){this.dialogVisible=!1,this.loadImages(!1)},del:function(e){var t=this;this.$confirm("确定删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading=!0,Object(c["a"])(e.id).then((function(a){e.loading=!0,t.loadImages(!1),t.$message({type:"success",message:"删除成功!"})}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},currentChange:function(e){this.page=e,this.loadImages(this.collect)},onStarImage:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.loading=!0,a.next=3,Object(c["c"])(e.id,!e.is_collected);case 3:e.loading=!1,t.loadImages(t.collect);case 5:case"end":return a.stop()}}),a)})))()}}},s=o,l=(a("8ce3"),a("2877")),u=Object(l["a"])(s,n,r,!1,null,"b470cd48",null);t["a"]=u.exports},e8b5:function(e,t,a){var n=a("c6b6");e.exports=Array.isArray||function(e){return"Array"==n(e)}}}]);
//# sourceMappingURL=chunk-33ecfa60.a16d23c2.js.map